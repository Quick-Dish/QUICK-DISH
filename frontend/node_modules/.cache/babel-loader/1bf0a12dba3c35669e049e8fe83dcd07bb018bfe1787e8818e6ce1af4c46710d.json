{"ast":null,"code":"// ... imports and existing routes ...\n\n// --- 1. GENERATE & SEND OTP ---\nrouter.post('/send-otp', async (req, res) => {\n  const {\n    email\n  } = req.body;\n  try {\n    // 1. Generate a random 6-digit code\n    const otpCode = Math.floor(100000 + Math.random() * 900000).toString();\n\n    // 2. Set Expiration (10 minutes from now)\n    const expiresAt = new Date(Date.now() + 10 * 60 * 1000);\n\n    // 3. Find user or Create a temporary one if they don't exist\n    let user = await User.findOne({\n      email\n    });\n    if (!user) {\n      // Create new user with just email\n      user = new User({\n        email\n      });\n    }\n\n    // 4. Save OTP to database\n    user.otp = otpCode;\n    user.otpExpires = expiresAt;\n    await user.save();\n\n    // 5. \"SEND\" the OTP (Log to Console for Dev Mode)\n    console.log(`=========================================`);\n    console.log(`ðŸ” OTP FOR ${email}: ${otpCode}`);\n    console.log(`=========================================`);\n    res.json({\n      msg: \"OTP Sent! Check your server console.\"\n    });\n  } catch (err) {\n    console.error(err);\n    res.status(500).json({\n      msg: \"Server Error\"\n    });\n  }\n});\n\n// --- 2. VERIFY OTP & LOGIN ---\nrouter.post('/verify-otp', async (req, res) => {\n  const {\n    email,\n    otp\n  } = req.body;\n  try {\n    const user = await User.findOne({\n      email\n    });\n    if (!user) return res.status(400).json({\n      msg: \"User not found\"\n    });\n\n    // Check if OTP matches and is not expired\n    if (user.otp !== otp || user.otpExpires < Date.now()) {\n      return res.status(400).json({\n        msg: \"Invalid or Expired OTP\"\n      });\n    }\n\n    // OTP is valid! Clear it so it can't be reused\n    user.otp = undefined;\n    user.otpExpires = undefined;\n\n    // If user has no name yet (new registration), set a default\n    if (!user.name) user.name = \"New Chef\";\n    await user.save();\n\n    // Generate Token (Same as normal login)\n    const token = jwt.sign({\n      id: user._id\n    }, process.env.JWT_SECRET, {\n      expiresIn: '1h'\n    });\n    res.json({\n      token,\n      user: {\n        id: user._id,\n        name: user.name,\n        email: user.email,\n        isAdmin: user.isAdmin\n      }\n    });\n  } catch (err) {\n    console.error(err);\n    res.status(500).json({\n      msg: \"Server Error\"\n    });\n  }\n});\nmodule.exports = router;","map":{"version":3,"names":["router","post","req","res","email","body","otpCode","Math","floor","random","toString","expiresAt","Date","now","user","User","findOne","otp","otpExpires","save","console","log","json","msg","err","error","status","undefined","name","token","jwt","sign","id","_id","process","env","JWT_SECRET","expiresIn","isAdmin","module","exports"],"sources":["D:/meal-kit-app/frontend/src/components/Login.js"],"sourcesContent":["// ... imports and existing routes ...\r\n\r\n// --- 1. GENERATE & SEND OTP ---\r\nrouter.post('/send-otp', async (req, res) => {\r\n  const { email } = req.body;\r\n  try {\r\n    // 1. Generate a random 6-digit code\r\n    const otpCode = Math.floor(100000 + Math.random() * 900000).toString();\r\n    \r\n    // 2. Set Expiration (10 minutes from now)\r\n    const expiresAt = new Date(Date.now() + 10 * 60 * 1000);\r\n\r\n    // 3. Find user or Create a temporary one if they don't exist\r\n    let user = await User.findOne({ email });\r\n    if (!user) {\r\n      // Create new user with just email\r\n      user = new User({ email });\r\n    }\r\n\r\n    // 4. Save OTP to database\r\n    user.otp = otpCode;\r\n    user.otpExpires = expiresAt;\r\n    await user.save();\r\n\r\n    // 5. \"SEND\" the OTP (Log to Console for Dev Mode)\r\n    console.log(`=========================================`);\r\n    console.log(`ðŸ” OTP FOR ${email}: ${otpCode}`);\r\n    console.log(`=========================================`);\r\n\r\n    res.json({ msg: \"OTP Sent! Check your server console.\" });\r\n\r\n  } catch (err) {\r\n    console.error(err);\r\n    res.status(500).json({ msg: \"Server Error\" });\r\n  }\r\n});\r\n\r\n// --- 2. VERIFY OTP & LOGIN ---\r\nrouter.post('/verify-otp', async (req, res) => {\r\n  const { email, otp } = req.body;\r\n  try {\r\n    const user = await User.findOne({ email });\r\n\r\n    if (!user) return res.status(400).json({ msg: \"User not found\" });\r\n\r\n    // Check if OTP matches and is not expired\r\n    if (user.otp !== otp || user.otpExpires < Date.now()) {\r\n      return res.status(400).json({ msg: \"Invalid or Expired OTP\" });\r\n    }\r\n\r\n    // OTP is valid! Clear it so it can't be reused\r\n    user.otp = undefined;\r\n    user.otpExpires = undefined;\r\n    \r\n    // If user has no name yet (new registration), set a default\r\n    if (!user.name) user.name = \"New Chef\";\r\n    \r\n    await user.save();\r\n\r\n    // Generate Token (Same as normal login)\r\n    const token = jwt.sign({ id: user._id }, process.env.JWT_SECRET, { expiresIn: '1h' });\r\n\r\n    res.json({ \r\n      token, \r\n      user: { id: user._id, name: user.name, email: user.email, isAdmin: user.isAdmin } \r\n    });\r\n\r\n  } catch (err) {\r\n    console.error(err);\r\n    res.status(500).json({ msg: \"Server Error\" });\r\n  }\r\n});\r\n\r\nmodule.exports = router;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}